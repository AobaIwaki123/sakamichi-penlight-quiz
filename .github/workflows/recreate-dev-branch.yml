name: Recreate Dev Branch

on:
  pull_request:
    types:
      - closed
    branches:
      - main

jobs:
  recreate-dev-branch:
    # devãƒ–ãƒ©ãƒ³ãƒãŒmainã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸå ´åˆã®ã¿å®Ÿè¡Œ
    if: github.event.pull_request.merged == true && github.event.pull_request.head.ref == 'dev'
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      pull-requests: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # æœ€æ–°ã®mainãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
          ref: main
          fetch-depth: 0
      
      - name: Configure Git
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
      
      - name: Delete existing dev branch (if exists)
        run: |
          # ãƒªãƒ¢ãƒ¼ãƒˆã®devãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆï¼‰
          if git ls-remote --heads origin dev | grep -q dev; then
            echo "æ—¢å­˜ã®devãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ã—ã¾ã™"
            git push origin --delete dev
          else
            echo "devãƒ–ãƒ©ãƒ³ãƒã¯å­˜åœ¨ã—ã¾ã›ã‚“"
          fi
        continue-on-error: true
      
      - name: Create new dev branch
        run: |
          # mainãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰æ–°ã—ã„devãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
          echo "mainãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰æ–°ã—ã„devãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã¾ã™"
          git checkout -b dev
          git push origin dev
      
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: dev
          base: main
          title: "ğŸš€ æ–°ã—ã„é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«é–‹å§‹"
          body: |
            ## æ¦‚è¦
            devãƒ–ãƒ©ãƒ³ãƒãŒmainã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸãŸã‚ã€æ–°ã—ã„é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«ç”¨ã®devãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã¾ã—ãŸã€‚
            
            ## å¤‰æ›´å†…å®¹
            - mainãƒ–ãƒ©ãƒ³ãƒã®æœ€æ–°çŠ¶æ…‹ã‹ã‚‰æ–°ã—ã„devãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ
            - æ¬¡ã®é–‹ç™ºã‚µã‚¤ã‚¯ãƒ«ã®æº–å‚™å®Œäº†
            
            ## å½±éŸ¿åº¦
            **ãƒ©ãƒ™ãƒ«**: `minor`
            
            **ç†ç”±**: æ–°ã—ã„é–‹ç™ºç’°å¢ƒã®æº–å‚™ï¼ˆæ©Ÿèƒ½è¿½åŠ ã®æº–å‚™ï¼‰
            
            ## å½±éŸ¿ç¯„å›²
            - é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç¶™ç¶š
            - æ–°æ©Ÿèƒ½é–‹ç™ºã®é–‹å§‹æº–å‚™
            
            ## æ³¨æ„äº‹é …
            - ã“ã®PRã¯é–‹ç™ºç”¨ãƒ–ãƒ©ãƒ³ãƒã®æº–å‚™ã§ã™
            - å®Ÿéš›ã®æ©Ÿèƒ½é–‹ç™ºã¯ã“ã®ãƒ–ãƒ©ãƒ³ãƒä¸Šã§è¡Œã£ã¦ãã ã•ã„
            
            ---
            *ã“ã®PRã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*
          labels: |
            minor
            automated
          draft: false