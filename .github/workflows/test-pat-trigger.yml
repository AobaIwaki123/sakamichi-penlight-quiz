name: test-pat-trigger
run-name: Test PAT Trigger Workflow

on:
  workflow_dispatch:
    inputs:
      test_tag:
        description: "ãƒ†ã‚¹ãƒˆç”¨ã‚¿ã‚°å (ä¾‹: test-v1.0.0)"
        required: true
        default: "test-v1.0.0"

permissions:
  contents: write

defaults:
  run:
    shell: bash

jobs:
  test-pat-tag-creation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Create Test Tag with PAT
        env:
          # Personal Access Tokenã‚’ä½¿ç”¨ã—ã¦ã‚¿ã‚°ã‚’ä½œæˆ
          GITHUB_TOKEN: ${{ secrets.PAT_TOKEN }}
          TEST_TAG: ${{ github.event.inputs.test_tag }}
        run: |
          echo "=== PATæ¨©é™ãƒ†ã‚¹ãƒˆ: ã‚¿ã‚°ä½œæˆ ==="
          echo "ä½œæˆã™ã‚‹ãƒ†ã‚¹ãƒˆã‚¿ã‚°: ${TEST_TAG}"
          
          # Gitãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # Personal Access Tokenã‚’ä½¿ç”¨ã—ã¦ãƒªãƒ¢ãƒ¼ãƒˆURLã‚’è¨­å®š
          if [ -n "${GITHUB_TOKEN}" ]; then
            echo "PAT_TOKEN ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™"
            git remote set-url origin "https://x-access-token:${GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY}.git"
          else
            echo "âŒ PAT_TOKEN ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"
            exit 1
          fi
          
          # ãƒ†ã‚¹ãƒˆç”¨ã‚¿ã‚°ã‚’ä½œæˆ
          git tag "${TEST_TAG}"
          echo "ã‚¿ã‚° ${TEST_TAG} ã‚’ä½œæˆã—ã¾ã—ãŸ"
          
          # ã‚¿ã‚°ã‚’ãƒ—ãƒƒã‚·ãƒ¥ï¼ˆã“ã‚Œã«ã‚ˆã‚Štest-pat-targetãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒèµ·å‹•ã™ã‚‹ã‹ãƒ†ã‚¹ãƒˆï¼‰
          git push origin "${TEST_TAG}"
          echo "âœ… ã‚¿ã‚° ${TEST_TAG} ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã—ãŸ"
          echo "test-pat-target ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒèµ·å‹•ã™ã‚‹ã‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„"

      - name: Test Result Summary
        run: |
          echo "=== ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ ==="
          echo "âœ… PAT_TOKEN ã‚’ä½¿ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆã‚¿ã‚°ã‚’ä½œæˆãƒ»ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã—ãŸ"
          echo "ğŸ“‹ æ¬¡ã®ç¢ºèªäº‹é …ï¼š"
          echo "  1. test-pat-target ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒè‡ªå‹•èµ·å‹•ã—ãŸã‹"
          echo "  2. ã‚¿ã‚°ãƒ—ãƒƒã‚·ãƒ¥ã‚¤ãƒ™ãƒ³ãƒˆãŒæ­£å¸¸ã«æ¤œçŸ¥ã•ã‚ŒãŸã‹"
          echo "  3. PATæ¨©é™ã§ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é€£æºãŒæ©Ÿèƒ½ã™ã‚‹ã‹"